<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoWatt Engineering Hub</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="global.css">
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const tg = window.Telegram.WebApp;
    
    // –°–æ–æ–±—â–∞–µ–º —Ç–µ–ª–µ–≥—Ä–∞–º—É, —á—Ç–æ –º—ã –≥–æ—Ç–æ–≤—ã
    tg.ready();
    
    // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω (–≤–∞–∂–Ω–æ –¥–ª—è –º–æ–±–∏–ª–æ–∫)
    tg.expand();

    // (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–æ–Ω –ø–æ–¥ —Ç–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    // document.body.style.backgroundColor = tg.themeParams.bg_color || "#f0f2f5";
</script>
</head>
<body>

    <header>
        <h1 class="brand-logo">EcoWatt <span style="color: #2980b9;">Suite</span></h1>
        <div class="brand-tagline">–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å v2.0 (Offline CRM)</div>
    </header>

    <div id="projects-section" style="width: 100%; max-width: 900px; margin-bottom: 40px;">
        <h2 style="color: var(--text-main); border-bottom: 2px solid #ddd; padding-bottom: 10px;">üìÇ –ú–æ–∏ –ü—Ä–æ–µ–∫—Ç—ã</h2>
        
        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <thead style="background: #f8f9fa;">
                <tr>
                    <th style="padding: 15px; text-align: left;">–ù–∞–∑–≤–∞–Ω–∏–µ / –ö–ª–∏–µ–Ω—Ç</th>
                    <th style="padding: 15px; text-align: left;">–î–∞—Ç–∞</th>
                    <th style="padding: 15px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="projects-list">
                </tbody>
        </table>
        <div id="no-projects-msg" style="padding: 20px; text-align: center; color: #7f8c8d; display: none;">
            –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤. –ù–∞–∂–º–∏—Ç–µ (+) –≤ —É–≥–ª—É.
        </div>
    </div>

    <main class="tools-grid">
        <a href="load-audit.html" class="tool-card">
            <div class="card-icon">üìã</div>
            <h3 class="card-title">–ê—É–¥–∏—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è</h3>
            <div class="card-desc">–†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Å—É—Ç–æ—á–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏.</div>
        </a>
        <a href="winter-voc.html" class="tool-card">
            <div class="card-icon">‚ùÑÔ∏è</div>
            <h3 class="card-title">–ó–∏–º–Ω–∏–π VOC</h3>
            <div class="card-desc">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∏–Ω–æ–≤ –ø–æ IEC 62548 (-25¬∞C).</div>
        </a>
        <a href="battery-calc.html" class="tool-card">
            <div class="card-icon">üîã</div>
            <h3 class="card-title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ê–ö–ë</h3>
            <div class="card-desc">–ü–æ–¥–±–æ—Ä –µ–º–∫–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –∞–≤—Ç–æ–Ω–æ–º–∏–∏.</div>
        </a>
        <a href="cable-calc.html" class="tool-card">
            <div class="card-icon">‚ö°</div>
            <h3 class="card-title">–°–µ—á–µ–Ω–∏–µ –∫–∞–±–µ–ª—è</h3>
            <div class="card-desc">–†–∞—Å—á–µ—Ç –ø–æ—Ç–µ—Ä—å –∏ —Ç–æ–∫–æ–≤–æ–π –∑–∞—â–∏—Ç—ã.</div>
        </a>
    </main>

    <footer>EcoWatt Engineering Suite v2.0 &copy; 2026</footer>

    <script src="project-manager.js"></script>
    <script>
        // –°–∫—Ä–∏–ø—Ç –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
        const list = document.getElementById('projects-list');
        const projects = ProjectManager.getAllProjects();
        const activeId = ProjectManager.getActiveProject().id;

        if (projects.length === 0) {
            document.getElementById('no-projects-msg').style.display = 'block';
        } else {
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–≤–µ–∂–∏–µ —Å–≤–µ—Ä—Ö—É
            projects.sort((a, b) => b.updatedAt - a.updatedAt);

            projects.forEach(p => {
                const tr = document.createElement('tr');
                const date = new Date(p.updatedAt).toLocaleDateString() + ' ' + new Date(p.updatedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const isActive = p.id === activeId;
                
                tr.innerHTML = `
                    <td style="padding: 15px; border-bottom: 1px solid #eee;">
                        <span style="font-weight: bold; font-size: 1.1rem;">${p.name}</span>
                        ${isActive ? '<span style="background:#d4edda; color:#155724; font-size:0.7rem; padding:2px 6px; border-radius:4px; margin-left:10px;">–ê–ö–¢–ò–í–ï–ù</span>' : ''}
                    </td>
                    <td style="padding: 15px; border-bottom: 1px solid #eee; color: #666;">${date}</td>
                    <td style="padding: 15px; border-bottom: 1px solid #eee; text-align: center;">
                        <button class="action-btn open-btn" data-id="${p.id}" style="background:var(--accent); color:white; border:none; padding:5px 15px; border-radius:4px; cursor:pointer;">–û—Ç–∫—Ä—ã—Ç—å</button>
                        <button class="action-btn del-btn" data-id="${p.id}" style="background:white; color:#c0392b; border:1px solid #eee; padding:5px 10px; border-radius:4px; cursor:pointer; margin-left:5px;">üóë</button>
                    </td>
                `;
                list.appendChild(tr);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
        list.addEventListener('click', (e) => {
            if(e.target.classList.contains('open-btn')) {
                const id = e.target.dataset.id;
                ProjectManager.loadProject(id);
                window.location.reload();
            }
            if(e.target.classList.contains('del-btn')) {
                const id = e.target.dataset.id;
                ProjectManager.deleteProject(id);
            }
        });
    </script>
</body>
</html>